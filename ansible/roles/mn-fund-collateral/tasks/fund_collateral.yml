---

- name: Populate payment targets
  set_fact:
    payment_targets: "{{ payment_targets | default( {} ) | combine( {masternodes[item].collateral.address: amount} ) }}"
  with_items:
    - "{{ masternode_names }}"

- name: Show list of payment targets
  debug:
    var: payment_targets

- name: Fund {{ amount }} coin(s) to listed masternodes
  command: "dash-cli {{ faucet_rpc_args }} sendmany \"\" '{{ payment_targets|to_json }}'"
  register: fund_result

- name: wait for funding TX {{ fund_result.stdout }} to appear on MN ctrl node
  shell: dash-cli {{ masternode_wallet_rpc_args }} getrawtransaction {{ fund_result.stdout }}
  register: check_result
  until: check_result.rc == 0
  retries: 10
  delay: 5
