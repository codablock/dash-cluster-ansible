---

# -----
# temporary solution to avoid permission errors after running smoke tests
# to be removed after dashmate json rpc
- name: Fix permissions before execute dashmate command
  ansible.builtin.file:
    path: "{{ dashmate_config_dir }}"
    recurse: true
    owner: "{{ dashmate_user }}"
    group: "{{ dashmate_group }}"

- name: Fix permissions before execute dashmate command
  ansible.builtin.file:
    path: '{{ dashmate_config_dir }}/ssl/{{ dash_network_name }}'
    owner: "101"
    group: "101"
# -----

- name: Reset platform (dashmate)
  ansible.builtin.import_role:
    name: dashmate
    tasks_from: reset_platform
  when: inventory_hostname in groups["hp_masternodes"]

- name: Remove platform docker containers and volumes
  community.docker.docker_compose:
    project_src: '{{ mn_evo_services_path }}'
    state: absent
    remove_volumes: false
  when:
    - inventory_hostname not in groups["hp_masternodes"]

- name: Delete platform dir
  ansible.builtin.file:
    state: absent
    path: '{{ mn_evo_services_path }}'

- name: Remove any remaining docker data
  community.docker.docker_prune:
    containers: true
    images: true
    images_filters:
      dangling: false
    networks: true
    volumes: true
    builder_cache: true
